<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë‹¹ì‹ ì˜ ê²€ì§€ë¥¼ ë¶€.ìˆ´. ë“œë¦½ë‹ˆë‹¤.</title>
  <style>
    *{touch-action:manipulation;-webkit-user-select:none;user-select:none}
    body{margin:0;display:flex;justify-content:center;align-items:center;height:100vh;background:linear-gradient(135deg,#111,#222);font-family:'Pretendard',system-ui,sans-serif;color:#fff;overflow:hidden}
    .game{width:360px;padding:20px;border-radius:20px;background:#1c1c1c;box-shadow:0 20px 40px rgba(0,0,0,.4);text-align:center;position:relative}
    h1{margin:0 0 10px;font-size:22px;line-height:1.25}
    .hud{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:14px}
    .btn{width:100%;height:120px;border-radius:16px;border:none;font-size:22px;cursor:pointer;background:linear-gradient(135deg,#ff4d4d,#ff884d);color:#fff;box-shadow:0 10px 20px rgba(0,0,0,.4);margin-bottom:10px}
    .reroll{height:48px;font-size:16px;background:linear-gradient(135deg,#4d7cff,#4dd2ff)}
    .btn:active{transform:scale(.97)}
    .hp{margin-top:4px;font-size:16px;letter-spacing:2px}
    .shake{animation:shake .3s}
    @keyframes shake{0%{transform:translate(0,0)}20%{transform:translate(-6px,0)}40%{transform:translate(6px,0)}60%{transform:translate(-6px,0)}80%{transform:translate(6px,0)}100%{transform:translate(0,0)}}
    .ssr-glow{animation:glow .8s ease-in-out 2}
    @keyframes glow{0%{box-shadow:none}50%{box-shadow:0 0 40px 10px rgba(255,215,0,.8)}100%{box-shadow:none}}
    .ssr-banner{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;font-size:36px;font-weight:800;letter-spacing:2px;color:#ffd700;text-shadow:0 0 20px rgba(255,215,0,.9);opacity:0;animation:banner .9s ease-in-out}
    @keyframes banner{0%{opacity:0;transform:scale(.8)}40%{opacity:1;transform:scale(1.05)}100%{opacity:0;transform:scale(1)}}
    .ending{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:10}
    .ending.show{display:flex}
    .ending-card{width:320px;padding:20px;border-radius:16px;text-align:center;background:#111;box-shadow:0 20px 40px rgba(0,0,0,.6)}
    .ending-title{font-size:22px;margin-bottom:8px}
    .ending-desc{font-size:14px;opacity:.9;margin-bottom:10px}
    .ending-score{font-size:18px;margin-bottom:10px}
    .ending-collection{font-size:12px;opacity:.8;margin-bottom:12px}
    .ending-btn{height:44px;font-size:16px}
  </style>
</head>
<body>
  <div class="game" id="game">
    <button id="collectionBtn" style="position:absolute;top:14px;right:14px;border:none;border-radius:12px;padding:6px 10px;font-size:12px;cursor:pointer;background:#333;color:#fff">ğŸ“• ì»¬ë ‰ì…˜</button>
    <h1>ë‹¹ì‹ ì˜ ê²€ì§€ë¥¼<br/>ë¶€.ìˆ´. ë“œë¦½ë‹ˆë‹¤.</h1>
    <div class="hud">
      <div>â± <span id="time">30</span>s</div>
      <div>ğŸ¯ <span id="score">0</span></div>
    </div>
    <button class="btn" id="clickBtn">ëˆŒëŸ¬!!!</button>
    <button class="btn reroll" id="rerollBtn">ğŸ° ë°°ìœ¨ ë¦¬ë¡¤ (ğŸ©¸ -1)</button>
    <div id="gacha"></div>
    <div class="hp" id="hp"></div>
  </div>

  <div class="ending" id="collectionModal">
    <div class="ending-card">
      <div class="ending-title">ì—”ë”© ì»¬ë ‰ì…˜</div>
      <div id="collectionList" style="font-size:13px;text-align:left;max-height:240px;overflow:auto;margin-bottom:12px"></div>
      <button class="btn ending-btn" id="closeCollection">ë‹«ê¸°</button>
    </div>
  </div>

  <div class="ending" id="ending">
    <div class="ending-card">
      <div class="ending-title" id="endingTitle"></div>
      <div class="ending-desc" id="endingDesc"></div>
      <div class="ending-score">ğŸ¯ ìµœì¢… ì ìˆ˜: <span id="endingScore"></span></div>
      <div class="ending-collection" id="endingCollection"></div>
      <button class="btn ending-btn" id="endingBtn">ë‹¤ì‹œ ë„ì „ ã„±ã„±</button>
    </div>
  </div>

  <script>
    let score=0,multiplier=1,playing=false,timerId=null;
    let combo=0,lastClickTime=0;
    const MAX_TIME=30, MAX_HP=5, COMBO_HEAL=20;
    let time=MAX_TIME, hp=MAX_HP;
    let ssrCount=0, rerollCount=0;

    const endings=[50,100,150,200,250,300];
    const endingStoreKey='finger_endings';

    const scoreEl=document.getElementById('score');
    const timeEl=document.getElementById('time');
    const btn=document.getElementById('clickBtn');
    const rerollBtn=document.getElementById('rerollBtn');
    const gachaText=document.getElementById('gacha');
    const gameEl=document.getElementById('game');
    const hpEl=document.getElementById('hp');
    const endingEl=document.getElementById('ending');
    const endingTitle=document.getElementById('endingTitle');
    const endingDesc=document.getElementById('endingDesc');
    const endingScore=document.getElementById('endingScore');
    const endingCollection=document.getElementById('endingCollection');
    const endingBtn=document.getElementById('endingBtn');
    const collectionBtn=document.getElementById('collectionBtn');
    const collectionModal=document.getElementById('collectionModal');
    const collectionList=document.getElementById('collectionList');
    const closeCollection=document.getElementById('closeCollection');

    function renderHP(){ hpEl.textContent='ğŸ©¸ '.repeat(Math.max(hp,0)); }

    btn.addEventListener('click',()=>{
      const now=Date.now();
      if(!playing && time===MAX_TIME){ startGame(); return; }
      if(!playing) return;

      if(now-lastClickTime<300) combo++; else combo=1;
      lastClickTime=now;

      if(combo===COMBO_HEAL && hp<MAX_HP){ hp++; renderHP(); }

      score+=multiplier;
      scoreEl.textContent=score;
    });

    rerollBtn.addEventListener('click',()=>{
      if(!playing || hp<=0) return;
      hp--; rerollCount++; renderHP(); rollGacha(true);
      if(hp<=0) endGame();
    });

    collectionBtn.addEventListener('click',()=>{ renderCollectionViewer(); collectionModal.classList.add('show'); });
    closeCollection.addEventListener('click',()=>collectionModal.classList.remove('show'));

    endingBtn.addEventListener('click',()=>{ endingEl.classList.remove('show'); resetForRetry(); });

    function startGame(){
      clearInterval(timerId);
      score=0; multiplier=1; time=MAX_TIME; hp=MAX_HP; combo=0; ssrCount=0; rerollCount=0;
      playing=true; scoreEl.textContent=score; timeEl.textContent=time; gachaText.textContent=''; renderHP();
      btn.textContent='ë¯¸ì¹œë“¯ì´ í´ë¦­'; rollGacha();
      timerId=setInterval(()=>{
        time--; timeEl.textContent=time;
        if(time%6===0){ hp=Math.max(hp-1,0); renderHP(); }
        if(time<=0 || hp<=0) endGame();
      },1000);
    }

    function endGame(){ clearInterval(timerId); playing=false; showEnding(score); }

    function resetForRetry(){ time=MAX_TIME; hp=MAX_HP; score=0; multiplier=1; combo=0; ssrCount=0; rerollCount=0; timeEl.textContent=time; renderHP(); scoreEl.textContent=score; gachaText.textContent=''; btn.textContent='ëˆŒëŸ¬!!!'; }

    function rollGacha(isReroll=false){
      const roll=Math.random();
      if(roll<.6) multiplier=1;
      else if(roll<.85) multiplier=2;
      else if(roll<.95) multiplier=3;
      else if(roll<.997) multiplier=5;
      else multiplier=10;

      gachaText.textContent=`${isReroll?'ğŸ”„ ë¦¬ë¡¤ ê²°ê³¼':'ğŸ° ë½‘ê¸° ê²°ê³¼'} : ì ìˆ˜ x${multiplier}`;

      if(multiplier>=3){ gameEl.classList.add('shake'); setTimeout(()=>gameEl.classList.remove('shake'),300); }
      if(multiplier>=5) triggerSSR(multiplier===10);
    }

    function triggerSSR(isEX=false){
      ssrCount++;
      gameEl.classList.add('ssr-glow');
      const b=document.createElement('div');
      b.className='ssr-banner';
      b.textContent=isEX?'EX!!!':'SSR!!!';
      gameEl.appendChild(b);
      setTimeout(()=>{ gameEl.classList.remove('ssr-glow'); b.remove(); },900);
    }

    function saveEnding(id,title){
      const data=JSON.parse(localStorage.getItem(endingStoreKey)||'{}');
      if(!data[id]){ data[id]={title,date:Date.now()}; localStorage.setItem(endingStoreKey,JSON.stringify(data)); }
    }

    function renderEndingCollection(){
      const data=JSON.parse(localStorage.getItem(endingStoreKey)||'{}');
      const total=endings.length+2;
      const count=Object.keys(data).length;
      endingCollection.textContent=`ì—”ë”© ì»¬ë ‰ì…˜: ${count} / ${total}`;
    }

    function renderCollectionViewer(){
      const data=JSON.parse(localStorage.getItem(endingStoreKey)||'{}');
      const all=[
        ['E50','í´ë¦­ ì¤‘ë…ì˜ ë¬¸í„±'],['E100','ì¤‘ê¸‰ í´ë¦­ëŸ¬'],['E150','ê·¼ìœ¡ ê¸°ì–µ ê°ì„±'],
        ['E200','ê²€ì§€ íŒŒê´´ì'],['E250','ì¸ê°„ í•œê³„ ëŒíŒŒ'],['E300','ì‹ ì˜ ê²€ì§€'],
        ['H1','ìš´ëª…ì„ ë˜ëŒë¦° ì'],['H2','ë¦¬ë¡¤ ì¤‘ë…ì']
      ];
      collectionList.innerHTML=all.map(([id,name])=>{
        if(data[id]) return `âœ… <b>${name}</b>`;
        return `ğŸ”’ ???`;
      }).join('<br/>');
    }

    function showEnding(finalScore){
      let title='ì—”ë”©: ì´ˆë³´ ê²€ì§€', desc='ì•„ì§ì€ ì›Œë°ì—… ë‹¨ê³„.', endingId='E0';
      if(ssrCount>=2 && rerollCount>0){ title='íˆë“  ì—”ë”©: ìš´ëª…ì„ ë˜ëŒë¦° ì'; desc='SSRì´ ì™€ë„ ë¦¬ë¡¤ì„ ë©ˆì¶”ì§€ ì•Šì•˜ë‹¤.'; endingId='H1'; }
      else if(finalScore===0 && rerollCount>0){ title='íˆë“  ì—”ë”©: ë¦¬ë¡¤ ì¤‘ë…ì'; desc='í´ë¦­ì€ ì•ˆ í–ˆë‹¤. ë„ë°•ë§Œ í–ˆë‹¤.'; endingId='H2'; }
      else if(finalScore>=300){ title='ì—”ë”©: ì‹ ì˜ ê²€ì§€'; desc='ë¬¼ë¦¬ ë²•ì¹™ì„ ë¬´ì‹œí–ˆë‹¤.'; endingId='E300'; }
      else if(finalScore>=250){ title='ì—”ë”©: ì¸ê°„ í•œê³„ ëŒíŒŒ'; desc='ì†ê°€ë½ì´ ê°ì„±í–ˆë‹¤.'; endingId='E250'; }
      else if(finalScore>=200){ title='ì—”ë”©: ê²€ì§€ íŒŒê´´ì'; desc='ì˜¤ëŠ˜ì€ ì‰¬ì„¸ìš”.'; endingId='E200'; }
      else if(finalScore>=150){ title='ì—”ë”©: ê·¼ìœ¡ ê¸°ì–µ ê°ì„±'; desc='í´ë¦­ ë¦¬ë“¬ ë§ˆìŠ¤í„°.'; endingId='E150'; }
      else if(finalScore>=100){ title='ì—”ë”©: ì¤‘ê¸‰ í´ë¦­ëŸ¬'; desc='ì†ë„ê°€ ëˆˆì— ëˆë‹¤.'; endingId='E100'; }
      else if(finalScore>=50){ title='ì—”ë”©: í´ë¦­ ì¤‘ë…ì˜ ë¬¸í„±'; desc='ì´ì œ ì‹œì‘ì´ë‹¤.'; endingId='E50'; }

      endingTitle.textContent=title;
      endingDesc.textContent=desc;
      endingScore.textContent=finalScore;

      saveEnding(endingId,title);
      renderEndingCollection();
      endingEl.classList.add('show');
    }
  </script>
</body>
</html>
